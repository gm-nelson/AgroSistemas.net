<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAD - Diseñador de Riego</title>
    <link rel="icon" type="image/webp" href="favicon.webp">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header id="mainHeader">
        <div class="main-header">
            <div class="container">
                <div class="logo">
                    <img src="logo.png" alt="Agrosistemas Logo">
                </div>
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <nav id="mainNav">
                    <ul>
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="CAD.html" class="current-page">CAD</a></li>
                        <li><a href="sistemaDeRiego.html">Sistemas de Riego</a></li>
                        <li><a href="energiaSolar.html">Energía Solar</a></li>
                        <li><a href="equipamientoAgricola.html">Equipamiento</a></li>
                        <li><a href="#contacto">Contacto</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="page-hero">
        <div class="container">
            <h1 class="fade-in">Diseña tu Sistema de Riego.</h1>
            <p class="fade-in delay-1">Con nuestra solución de Computer Assisted Drawing para hacer tus proyectos.</p>
            <a href="#contacto" class="btn fade-in delay-2">Solicitar Asesoría</a>
        </div>
    </section>

    <!-- Diseñador de Riego CAD -->
    <section class="disenador-riego" id="disenador-riego">
        <div class="container">
            <h2 class="section-title">Diseñador de Sistemas de Riego</h2>
            <p class="disenador-intro fade-in">Diseña tu sistema de riego de manera interactiva. Ubica tu predio en el mapa, delimita las secciones y configura tuberías, emisores y elementos del sistema.</p>
            
            <div class="disenador-grid">
                <!-- Panel del Mapa -->
                <div class="mapa-panel fade-in">
                    <div class="mapa-header">
                        <h3>Ubicación del Predio</h3>
                        <div class="area-display" id="areaDisplay">Área: 0 m²</div>
                    </div>
                    <div class="mapa-container">
                        <div id="map"></div>
                        <div class="mapa-controls" id="mapaControls">
                            <div class="search-container">
                                <input type="text" id="location-search" placeholder="Buscar ubicación...">
                                <button id="searchBtn" class="mapa-btn" style="margin-top: 5px; padding: 5px 10px; font-size: 0.8rem;">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                            </div>
                            <div class="mapa-buttons">
                                <button class="mapa-btn" id="drawPolygonBtn">
                                    <i class="fas fa-draw-polygon"></i> Delimitar Terreno
                                </button>
                                <button class="mapa-btn secondary" id="measureBtn">
                                    <i class="fas fa-ruler"></i> Medir
                                </button>
                                <button class="mapa-btn secondary" id="clearBtn">
                                    <i class="fas fa-trash"></i> Limpiar
                                </button>
                                <button class="mapa-btn secondary" id="hideControlsBtn" style="display: none;">
                                    <i class="fas fa-eye-slash"></i> Ocultar Controles
                                </button>
                                <button class="mapa-btn secondary" id="showControlsBtn" style="display: none;">
                                    <i class="fas fa-eye"></i> Mostrar Controles
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Panel de Diseño CAD -->
                <div class="cad-panel fade-in delay-1">
                    <div class="cad-header">
                        <h3>Diseño del Sistema de Riego</h3>
                        <p>Configura tuberías, emisores y elementos del sistema</p>
                    </div>
                    
                    <div class="cad-tabs">
                        <div class="cad-tab active" data-tab="tuberias">Tuberías</div>
                        <div class="cad-tab" data-tab="elementos">Elementos</div>
                        <div class="cad-tab" data-tab="resultados">Resultados</div>
                        <div class="cad-tab" data-tab="galeria">Galería</div>
                    </div>
                    
                    <div class="cad-content">
                        <!-- Pestaña de Tuberías -->
                        <div class="cad-tab-content active" id="tuberias-tab">
                            <div class="control-group">
                                <h4>Tubería Principal</h4>
                                <div class="control-row">
                                    <div class="control-label">Color:</div>
                                    <div class="color-indicator color-principal"></div>
                                    <div>Rojo (Grosor: 8px)</div>
                                </div>
                                <div class="control-row">
                                    <div class="control-label">Diámetro:</div>
                                    <select id="diametroPrincipal">
                                        <option value="2">2"</option>
                                        <option value="3">3"</option>
                                        <option value="4">4"</option>
                                        <option value="6">6"</option>
                                        <option value="8">8"</option>
                                        <option value="10">10"</option>
                                        <option value="12">12"</option>
                                        <option value="14">14"</option>
                                        <option value="16">16"</option>
                                        <option value="18">18"</option>
                                        <option value="20">20"</option>
                                    </select>
                                </div>
                                <div class="control-row">
                                    <div class="control-label">Tipo:</div>
                                    <select id="tipoPrincipal">
                                        <option value="pvc">PVC</option>
                                        <option value="manguera">Manguera</option>
                                    </select>
                                </div>
                                <button class="tuberia-btn" onclick="iniciarModoTuberia('principal')" id="btnTuberiaPrincipal">
                                    <i class="fas fa-pencil-alt"></i> Dibujar Tubería Principal
                                </button>
                                <button class="tuberia-btn conexion-btn" onclick="iniciarModoConexion('principal')" id="btnConectarPrincipal" style="margin-top: 5px;">
                                    <i class="fas fa-link"></i> Conectar Tuberías
                                </button>
                                <div class="instrucciones-tuberia" id="instruccionesPrincipal" style="display: none;">
                                    Haz clic en el mapa para iniciar la tubería. Click para agregar puntos. Doble click para finalizar.
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4>Tubería Secundaria</h4>
                                <div class="control-row">
                                    <div class="control-label">Color:</div>
                                    <div class="color-indicator color-secundaria"></div>
                                    <div>Turquesa (Grosor: 6px)</div>
                                </div>
                                <div class="control-row">
                                    <div class="control-label">Diámetro:</div>
                                    <select id="diametroSecundaria">
                                        <option value="1">1"</option>
                                        <option value="1.5">1.5"</option>
                                        <option value="2">2"</option>
                                        <option value="3">3"</option>
                                        <option value="4">4"</option>
                                    </select>
                                </div>
                                <div class="control-row">
                                    <div class="control-label">Tipo:</div>
                                    <select id="tipoSecundaria">
                                        <option value="pvc">PVC</option>
                                        <option value="manguera">Manguera</option>
                                    </select>
                                </div>
                                <button class="tuberia-btn" onclick="iniciarModoTuberia('secundaria')" id="btnTuberiaSecundaria">
                                    <i class="fas fa-pencil-alt"></i> Dibujar Tubería Secundaria
                                </button>
                                <button class="tuberia-btn conexion-btn" onclick="iniciarModoConexion('secundaria')" id="btnConectarSecundaria" style="margin-top: 5px;">
                                    <i class="fas fa-link"></i> Conectar Tuberías
                                </button>
                                <div class="instrucciones-tuberia" id="instruccionesSecundaria" style="display: none;">
                                    Haz clic en el mapa para iniciar la tubería. Click para agregar puntos. Doble click para finalizar.
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4>Tubería Regante</h4>
                                <div class="control-row">
                                    <div class="control-label">Color:</div>
                                    <div class="color-indicator color-regante"></div>
                                    <div>Azul (Grosor: 4px)</div>
                                </div>
                                <div class="control-row">
                                    <div class="control-label">Diámetro:</div>
                                    <select id="diametroRegante">
                                        <option value="0.5">1/2"</option>
                                        <option value="0.75">3/4"</option>
                                        <option value="1">1"</option>
                                    </select>
                                </div>
                                <div class="control-row">
                                    <div class="control-label">Tipo:</div>
                                    <select id="tipoRegante">
                                        <option value="pvc">PVC</option>
                                        <option value="manguera">Manguera</option>
                                    </select>
                                </div>
                                <button class="tuberia-btn" onclick="iniciarModoTuberia('regante')" id="btnTuberiaRegante">
                                    <i class="fas fa-pencil-alt"></i> Dibujar Tubería Regante
                                </button>
                                <button class="tuberia-btn conexion-btn" onclick="iniciarModoConexion('regante')" id="btnConectarRegante" style="margin-top: 5px;">
                                    <i class="fas fa-link"></i> Conectar Tuberías
                                </button>
                                <div class="instrucciones-tuberia" id="instruccionesRegante" style="display: none;">
                                    Haz clic en el mapa para iniciar la tubería. Click para agregar puntos. Doble click para finalizar.
                                </div>
                            </div>
                            
                            <div class="cad-resumen">
                                <h4>Resumen de Tuberías</h4>
                                <div id="resumenTuberiasDetallado">
                                    <!-- Aquí se mostrará el resumen detallado por diámetros -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pestaña de Elementos -->
                        <div class="cad-tab-content" id="elementos-tab">
                            <div class="control-group">
                                <h4>Agregar Elementos al Diseño</h4>
                                <div class="elementos-lista">
                                    <div class="elemento-btn active" data-elemento="cabezal" onclick="iniciarModoElemento('cabezal')">
                                        <i class="fas fa-gear"></i> Cabezal
                                    </div>
                                    <div class="elemento-btn" data-elemento="purgaterminal" onclick="iniciarModoElemento('purgaterminal')">
                                        <i class="fas fa-faucet"></i> Purgas/Terminales
                                    </div>
                                    <div class="elemento-btn" data-elemento="tomagua" onclick="iniciarModoElemento('tomagua')">
                                        <i class="fas fa-tint"></i> Toma de Agua
                                    </div>
                                    <div class="elemento-btn" data-elemento="valvula" onclick="iniciarModoElemento('valvula')">
                                        <i class="fas fa-toggle-on"></i> Válvula
                                    </div>
                                    <div class="elemento-btn" data-elemento="filtro" onclick="iniciarModoElemento('filtro')">
                                        <i class="fas fa-filter"></i> Filtro
                                    </div>
                                </div>
                                <div class="instrucciones-tuberia" id="instruccionesElementos" style="display: none;">
                                    Haz clic en el mapa para colocar el elemento seleccionado.
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4>Configuración del Elemento</h4>
                                <div id="elementoConfig">
                                    <p>Selecciona un elemento para configurarlo</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pestaña de Resultados -->
                        <div class="cad-tab-content resultados-tab" id="resultados-tab">
                            <div class="control-group">
                                <h4>Resultados del Diseño</h4>
                                <div id="resultadosCalculos">
                                    <!-- Aquí se mostrarán todos los cálculos -->
                                </div>
                                <button class="btn btn-export-pdf" onclick="exportarPDF()">
                                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pestaña de Galería -->
                        <div class="cad-tab-content" id="galeria-tab">
                            <div class="control-group">
                                <h4>Diseños Guardados</h4>
                                <div class="galeria-acciones">
                                    <button class="btn" onclick="guardarDiseño()" style="margin-right: 10px;">
                                        <i class="fas fa-save"></i> Guardar Actual
                                    </button>
                                    <button class="btn btn-secondary" onclick="exportarDiseño()">
                                        <i class="fas fa-download"></i> Exportar JSON
                                    </button>
                                    <label class="btn btn-secondary" style="display: inline-block; cursor: pointer;">
                                        <i class="fas fa-upload"></i> Importar JSON
                                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importarDiseño(event)">
                                    </label>
                                </div>
                                <div class="control-group">
                                    <h4>Captura para PDF</h4>
                                    <div class="galeria-acciones">
                                        <button class="btn" onclick="capturarDiseñoActual()">
                                            <i class="fas fa-camera"></i> Capturar Diseño Actual
                                        </button>
                                        <button class="btn" onclick="forzarRecaptura()" style="background-color: #ff9f43;">
                                            <i class="fas fa-sync-alt"></i> Nueva Captura
                                        </button>
                                    </div>
                                    <div id="capturaStatus" style="margin-top: 10px; min-height: 60px;">
                                        <!-- Estado de la captura aparecerá aquí -->
                                    </div>
                                </div>
                                
                                <div class="galeria-diseños" id="galeriaDiseños" style="margin-top: 20px; max-height: 300px; overflow-y: auto;">
                                    <!-- Diseños se cargarán aquí -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contacto -->
    <section class="contacto" id="contacto">
        <div class="container">
            <h2 class="section-title">Contacto</h2>
            <div class="contacto-grid">
                <div class="contact-info-card fade-in">
                    <h3>Información de Contacto</h3>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="contact-text">
                            <h4>Dirección</h4>
                            <p>Los Mochis, Sinaloa, México</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="contact-text">
                            <h4>Teléfono</h4>
                            <a href="tel:+526681234567">+52 668 123 4567</a>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="contact-text">
                            <h4>Email</h4>
                            <a href="mailto:info@agrosistemas.com">info@agrosistemas.com</a>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="contact-text">
                            <h4>Horario de Atención</h4>
                            <p>Lunes a Viernes: 8:00 - 18:00<br>Sábados: 9:00 - 13:00</p>
                        </div>
                    </div>
                </div>
                
                <div class="fade-in delay-1">
                    <h3 style="margin-bottom: 20px; color: #111;">Ubicación</h3>
                    <div class="map-container">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d115260.94825251572!2d-109.02480815!3d25.813333!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x86c7a5f40b6e008d%3A0x9a3f37c0e13f2cf6!2sLos%20Mochis%2C%20Sin.!5e0!3m2!1ses-419!2smx!4v1689690161688!5m2!1ses-419!2smx" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="logo.png" alt="Agrosistemas Logo">
                </div>
                <p class="footer-text">Especialistas en soluciones agrícolas integrales. Optimizamos tu producción con tecnología de punta y asesoría técnica especializada.</p>
                <div class="copyright">
                    &copy; 2024 Agrosistemas. Todos los derechos reservados.
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="script.js"></script>
</body>
</html>