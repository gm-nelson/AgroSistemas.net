<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Monitor</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
  --bg:#0f2027;
  --card:#16232e;
  --accent:#00c6ff;
  --down:#4caf50;
  --up:#ffc107;
  --bad:#f44336;
}

*{box-sizing:border-box;font-family:system-ui,Segoe UI}

body{
  margin:0;
  background:linear-gradient(135deg,#0f2027,#203a43);
  color:#eaf6ff;
  padding:20px;
}

.container{max-width:1200px;margin:auto}

header{text-align:center;margin-bottom:25px}

header h1{
  margin:0;
  font-size:2.4rem;
  background:linear-gradient(90deg,var(--accent),#0072ff);
  -webkit-background-clip:text;
  color:transparent;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(340px,1fr));
  gap:20px;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.35);
}

.card h2{
  margin:0 0 15px;
  display:flex;
  align-items:center;
  gap:10px;
}

.row{display:flex;gap:10px;margin-bottom:10px}

input,button{
  border:none;
  border-radius:10px;
  padding:12px;
  font-size:1rem;
}

input{flex:1;background:#1f3342;color:white}

button{
  background:linear-gradient(90deg,#0072ff,var(--accent));
  color:white;
  font-weight:600;
  cursor:pointer;
}

button:disabled{opacity:.5}

.status{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin:15px 0;
}

.dot{
  width:12px;height:12px;border-radius:50%;
  background:var(--bad);
}

.big{
  text-align:center;
  font-size:2.8rem;
  font-weight:700;
  color:var(--accent);
}

.stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

.box{
  background:#1c2f3d;
  border-radius:10px;
  padding:10px;
  text-align:center;
}

.box strong{
  display:block;
  font-size:1.4rem;
  color:var(--accent);
}

canvas{
  width:100%;
  background:#0e1a22;
  border-radius:12px;
  margin-top:15px;
}

.legend{
  margin-top:8px;
  font-size:.85rem;
  color:#9bdcff;
  display:flex;
  gap:15px;
}

.legend span{display:flex;align-items:center;gap:6px}
.legend i{font-size:.7rem}

footer{
  text-align:center;
  margin-top:30px;
  font-size:.9rem;
  color:#7fbcd9;
}
</style>
</head>

<body>
<div class="container">

<header>
<h1><i class="fas fa-network-wired"></i> Network Monitor</h1>
<p>Latencia, velocidad y uso de red en tiempo real</p>
</header>

<div class="grid">

<!-- PING -->
<div class="card">
<h2><i class="fas fa-satellite-dish"></i> Ping</h2>

<div class="row">
<input value="8.8.8.8" disabled>
<button id="btnPing">Ping</button>
<button id="btnLoop">Continuo</button>
<button id="btnStop" disabled>Stop</button>
</div>

<div class="status">
<div class="dot" id="statusDot"></div>
<span id="statusText">Desconectado</span>
</div>

<div class="big" id="pingValue">-- ms</div>

<div class="stats">
<div class="box"><strong id="avgPing">--</strong>Avg</div>
<div class="box"><strong id="minPing">--</strong>Min</div>
<div class="box"><strong id="maxPing">--</strong>Max</div>
</div>
</div>

<!-- RENDIMIENTO -->
<div class="card">
<h2><i class="fas fa-chart-line"></i> Métricas de Red</h2>

<div class="stats">
<div class="box"><strong id="downSpeed">--</strong>Mbps ↓</div>
<div class="box"><strong id="upSpeed">--</strong>Mbps ↑</div>
<div class="box"><strong id="netType">--</strong>Red</div>
</div>

<button id="btnSpeed" style="margin-top:15px;width:100%">Speedtest</button>

<canvas id="netChart" height="220"></canvas>

<div class="legend">
<span><i style="color:var(--accent)" class="fas fa-circle"></i> Latency (ms)</span>
<span><i style="color:var(--down)" class="fas fa-circle"></i> Download (Mbps)</span>
<span><i style="color:var(--up)" class="fas fa-circle"></i> Upload (Mbps)</span>
</div>
</div>

</div>

<footer>
Network Monitor • Canvas • HTML5 • Sin backend
</footer>

</div>

<script>
/* =======================
   ESTADO GLOBAL
======================= */
let pingTimes=[];
let intervalId=null;
let netData=[]; // {time, latency, down, up}
const MAX_POINTS=20;

/* =======================
   ELEMENTOS
======================= */
const pingValue=document.getElementById('pingValue');
const statusDot=document.getElementById('statusDot');
const statusText=document.getElementById('statusText');
const avgPing=document.getElementById('avgPing');
const minPing=document.getElementById('minPing');
const maxPing=document.getElementById('maxPing');

const downSpeed=document.getElementById('downSpeed');
const upSpeed=document.getElementById('upSpeed');
const netType=document.getElementById('netType');

const btnPing=document.getElementById('btnPing');
const btnLoop=document.getElementById('btnLoop');
const btnStop=document.getElementById('btnStop');
const btnSpeed=document.getElementById('btnSpeed');

/* =======================
   PING
======================= */
function simulatePing(){
  return new Promise(r=>{
    const t=30+Math.random()*150;
    setTimeout(()=>r(Math.round(t)),t);
  });
}

async function doPing(){
  pingValue.textContent="...";
  const t=await simulatePing();

  pingTimes.push(t);
  if(pingTimes.length>30) pingTimes.shift();

  pingValue.textContent=t+" ms";
  statusText.textContent="Conectado";
  statusDot.style.background=t<100?"#4caf50":t<250?"#ffc107":"#f44336";

  avgPing.textContent=Math.round(pingTimes.reduce((a,b)=>a+b,0)/pingTimes.length);
  minPing.textContent=Math.min(...pingTimes);
  maxPing.textContent=Math.max(...pingTimes);

  logSample({latency:t});
}

btnPing.onclick=doPing;
btnLoop.onclick=()=>{
  btnPing.disabled=btnLoop.disabled=true;
  btnStop.disabled=false;
  intervalId=setInterval(doPing,2000);
};
btnStop.onclick=()=>{
  clearInterval(intervalId);
  btnPing.disabled=btnLoop.disabled=false;
  btnStop.disabled=true;
};

/* =======================
   SPEEDTEST
======================= */
btnSpeed.onclick=async()=>{
  downSpeed.textContent="...";
  upSpeed.textContent="...";
  const down=await testSpeed(5);
  const up=await testSpeed(3);
  downSpeed.textContent=down.toFixed(1);
  upSpeed.textContent=up.toFixed(1);
  logSample({down,up});
};

function testSpeed(mb){
  const start=performance.now();
  return new Promise(r=>setTimeout(()=>{
    const t=(performance.now()-start)/1000;
    r((mb*8)/t);
  },400+Math.random()*400));
}

/* =======================
   INFO RED
======================= */
if(navigator.connection){
  const c=navigator.connection;
  netType.textContent=`${c.effectiveType} (${c.downlink}Mb)`;
}else netType.textContent="N/A";

/* =======================
   DATA + GRÁFICA
======================= */
const canvas=document.getElementById('netChart');
const ctx=canvas.getContext('2d');

function logSample({latency=null,down=null,up=null}){
  const now=new Date().toLocaleTimeString();
  netData.push({time:now,latency,down,up});
  if(netData.length>MAX_POINTS) netData.shift();
  drawChart();
}

function drawChart(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const pad=35,w=canvas.width,h=canvas.height;

  ctx.strokeStyle="#2a475a";
  ctx.beginPath();
  ctx.moveTo(pad,10);
  ctx.lineTo(pad,h-pad);
  ctx.lineTo(w-10,h-pad);
  ctx.stroke();

  if(netData.length<2) return;

  const latMax=Math.max(...netData.map(d=>d.latency||0),200);
  const downMax=Math.max(...netData.map(d=>d.down||0),50);
  const upMax=Math.max(...netData.map(d=>d.up||0),20);

  const stepX=(w-pad-10)/(netData.length-1);

  const plot=(key,max,color)=>{
    ctx.strokeStyle=color;
    ctx.beginPath();
    netData.forEach((d,i)=>{
      if(d[key]==null) return;
      const x=pad+i*stepX;
      const y=(h-pad)-(d[key]/max)*(h-pad-20);
      i?ctx.lineTo(x,y):ctx.moveTo(x,y);
    });
    ctx.stroke();
  };

  plot('latency',latMax,'#00c6ff');
  plot('down',downMax,'#4caf50');
  plot('up',upMax,'#ffc107');

  ctx.fillStyle='#7fbcd9';
  ctx.font='10px system-ui';
  netData.forEach((d,i)=>{
    if(i%4===0){
      const x=pad+i*stepX;
      ctx.fillText(d.time,x-12,h-10);
    }
  });
}
</script>
</body>
</html>
